<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<!-- GenHTML revision 25226-->
<meta http-equiv="Content-type" content="text/html; charset=utf-8">
<title>Creating the Component Tag Handler - The Java EE 6 Tutorial</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2012-04-01">
<link rel="stylesheet" type="text/css" href="css/default.css">
<link rel="stylesheet" type="text/css" href="css/ipg.css">
<link rel="stylesheet" type="text/css" href="css/javaeetutorial.css">
</head>

<body>

<table border="0" cellpadding="5" cellspacing="0" width="100%">
<tbody>
   <tr valign="top">
      <td width="400px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="gexaf.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="gfirp.html">Part&nbsp;I&nbsp;Introduction</a></p>
<p class="toc level2"><a href="bnaaw.html">1.&nbsp;&nbsp;Overview</a></p>
<p class="toc level2"><a href="gfiud.html">2.&nbsp;&nbsp;Using the Tutorial Examples</a></p>
<p class="toc level1 tocsp"><a href="bnadp.html">Part&nbsp;II&nbsp;The Web Tier</a></p>
<p class="toc level2"><a href="bnadr.html">3.&nbsp;&nbsp;Getting Started with Web Applications</a></p>
<p class="toc level2"><a href="bnaph.html">4.&nbsp;&nbsp;JavaServer Faces Technology</a></p>
<p class="toc level2"><a href="giepx.html">5.&nbsp;&nbsp;Introduction to Facelets</a></p>
<p class="toc level2"><a href="gjddd.html">6.&nbsp;&nbsp;Expression Language</a></p>
<p class="toc level2"><a href="bnaqz.html">7.&nbsp;&nbsp;Using JavaServer Faces Technology in Web Pages</a></p>
<p class="toc level2"><a href="gjcut.html">8.&nbsp;&nbsp;Using Converters, Listeners, and Validators</a></p>
<p class="toc level2"><a href="bnatx.html">9.&nbsp;&nbsp;Developing with JavaServer Faces Technology</a></p>
<p class="toc level2"><a href="gkmaa.html">10.&nbsp;&nbsp;JavaServer Faces Technology: Advanced Concepts</a></p>
<p class="toc level2"><a href="gkiow.html">11.&nbsp;&nbsp;Using Ajax with JavaServer Faces Technology</a></p>
<p class="toc level2"><a href="gkhxa.html">12.&nbsp;&nbsp;Composite Components: Advanced Topics and Example</a></p>
<p class="toc level2"><a href="bnavg.html">13.&nbsp;&nbsp;Creating Custom UI Components and Other Custom Objects</a></p>
<p class="toc level3"><a href="bnavh.html">Determining Whether You Need a Custom Component or Renderer</a></p>
<p class="toc level4"><a href="bnavh.html#bnavi">When to Use a Custom Component</a></p>
<p class="toc level4"><a href="bnavh.html#bnavj">When to Use a Custom Renderer</a></p>
<p class="toc level4"><a href="bnavh.html#bnavk">Component, Renderer, and Tag Combinations</a></p>
<p class="toc level3 tocsp"><a href="glpcb.html">Understanding the Image Map Example</a></p>
<p class="toc level4"><a href="glpcb.html#glpbd">Why Use JavaServer Faces Technology to Implement an Image Map?</a></p>
<p class="toc level4"><a href="glpcb.html#glpem">Understanding the Rendered HTML</a></p>
<p class="toc level4"><a href="glpcb.html#glpcd">Understanding the Facelets Page</a></p>
<p class="toc level4"><a href="glpcb.html#glpbo">Configuring Model Data</a></p>
<p class="toc level4"><a href="glpcb.html#glpel">Summary of the Image Map Application Classes</a></p>
<p class="toc level3 tocsp"><a href="bnavt.html">Steps for Creating a Custom Component</a></p>
<p class="toc level3"><a href="bnavu.html">Creating Custom Component Classes</a></p>
<p class="toc level4"><a href="bnavu.html#bnavv">Specifying the Component Family</a></p>
<p class="toc level4"><a href="bnavu.html#bnavw">Performing Encoding</a></p>
<p class="toc level4"><a href="bnavu.html#bnavx">Performing Decoding</a></p>
<p class="toc level4"><a href="bnavu.html#bnavy">Enabling Component Properties to Accept Expressions</a></p>
<p class="toc level4"><a href="bnavu.html#bnavz">Saving and Restoring State</a></p>
<p class="toc level3 tocsp"><a href="bnawa.html">Delegating Rendering to a Renderer</a></p>
<p class="toc level4"><a href="bnawa.html#bnawb">Creating the Renderer Class</a></p>
<p class="toc level4"><a href="bnawa.html#bnawc">Identifying the Renderer Type</a></p>
<p class="toc level3 tocsp"><a href="bnaut.html">Implementing an Event Listener</a></p>
<p class="toc level4"><a href="bnaut.html#bnauu">Implementing Value-Change Listeners</a></p>
<p class="toc level4"><a href="bnaut.html#bnauv">Implementing Action Listeners</a></p>
<p class="toc level3 tocsp"><a href="bnawd.html">Handling Events for Custom Components</a></p>
<div id="scrolltoc" class="onpage">
<p class="toc level3"><a href="">Creating the Component Tag Handler</a></p>
<p class="toc level4"><a href="#bnawf">Retrieving the Component Type</a></p>
<p class="toc level4"><a href="#bnawg">Setting Component Property Values</a></p>
<p class="toc level5"><a href="#bnawh">Getting the Attribute Values</a></p>
<p class="toc level5"><a href="#bnawi">Setting the Component Property Values</a></p>
<p class="toc level4 tocsp"><a href="#bnawl">Providing the Renderer Type</a></p>
<p class="toc level4"><a href="#bnawm">Releasing Resources</a></p>
</div>
<p class="toc level3 tocsp"><a href="bnawn.html">Defining the Custom Component Tag in a Tag Library Descriptor</a></p>
<p class="toc level3"><a href="bnatt.html">Using A Custom Component</a></p>
<p class="toc level3"><a href="bnaus.html">Creating and Using a Custom Converter</a></p>
<p class="toc level4"><a href="bnaus.html#glphb">Creating a Custom Converter</a></p>
<p class="toc level4"><a href="bnaus.html#bnatu">Using a Custom Converter</a></p>
<p class="toc level3 tocsp"><a href="bnauw.html">Creating and Using a Custom Validator</a></p>
<p class="toc level4"><a href="bnauw.html#bnaux">Implementing the Validator Interface</a></p>
<p class="toc level4"><a href="bnauw.html#bnauy">Creating a Custom Tag</a></p>
<p class="toc level5"><a href="bnauw.html#bnauz">Writing the Tag Handler</a></p>
<p class="toc level5"><a href="bnauw.html#bnava">Writing the Tag Library Descriptor</a></p>
<p class="toc level4 tocsp"><a href="bnauw.html#bnatv">Using a Custom Validator</a></p>
<p class="toc level3 tocsp"><a href="bnatg.html">Binding Component Values and Instances to Managed Bean Properties</a></p>
<p class="toc level4"><a href="bnatg.html#bnati">Binding a Component Value to a Property</a></p>
<p class="toc level4"><a href="bnatg.html#bnatj">Binding a Component Value to an Implicit Object</a></p>
<p class="toc level4"><a href="bnatg.html#bnatl">Binding a Component Instance to a Bean Property</a></p>
<p class="toc level3 tocsp"><a href="bnatm.html">Binding Converters, Listeners, and Validators to Managed Bean Properties</a></p>
<p class="toc level2 tocsp"><a href="bnawo.html">14.&nbsp;&nbsp;Configuring JavaServer Faces Applications</a></p>
<p class="toc level2"><a href="bnafd.html">15.&nbsp;&nbsp;Java Servlet Technology</a></p>
<p class="toc level2"><a href="glrbb.html">16.&nbsp;&nbsp;Java Servlet Technology: Advanced Topics</a></p>
<p class="toc level2"><a href="bnaxu.html">17.&nbsp;&nbsp;Internationalizing and Localizing Web Applications</a></p>
<p class="toc level1 tocsp"><a href="bnayk.html">Part&nbsp;III&nbsp;Web Services</a></p>
<p class="toc level2"><a href="gijti.html">18.&nbsp;&nbsp;Introduction to Web Services</a></p>
<p class="toc level2"><a href="bnayl.html">19.&nbsp;&nbsp;Building Web Services with JAX-WS</a></p>
<p class="toc level2"><a href="giepu.html">20.&nbsp;&nbsp;Building RESTful Web Services with JAX-RS</a></p>
<p class="toc level2"><a href="gjjxe.html">21.&nbsp;&nbsp;JAX-RS: Advanced Topics and Example</a></p>
<p class="toc level1 tocsp"><a href="bnblr.html">Part&nbsp;IV&nbsp;Enterprise Beans</a></p>
<p class="toc level2"><a href="gijsz.html">22.&nbsp;&nbsp;Enterprise Beans</a></p>
<p class="toc level2"><a href="gijre.html">23.&nbsp;&nbsp;Getting Started with Enterprise Beans</a></p>
<p class="toc level2"><a href="gijrb.html">24.&nbsp;&nbsp;Running the Enterprise Bean Examples</a></p>
<p class="toc level2"><a href="bnbpk.html">25.&nbsp;&nbsp;A Message-Driven Bean Example</a></p>
<p class="toc level2"><a href="gkcqz.html">26.&nbsp;&nbsp;Using the Embedded Enterprise Bean Container</a></p>
<p class="toc level2"><a href="gkidz.html">27.&nbsp;&nbsp;Using Asynchronous Method Invocation in Session Beans</a></p>
<p class="toc level1 tocsp"><a href="gjbnr.html">Part&nbsp;V&nbsp;Contexts and Dependency Injection for the Java EE Platform</a></p>
<p class="toc level2"><a href="giwhb.html">28.&nbsp;&nbsp;Introduction to Contexts and Dependency Injection for the Java EE Platform</a></p>
<p class="toc level2"><a href="gjbls.html">29.&nbsp;&nbsp;Running the Basic Contexts and Dependency Injection Examples</a></p>
<p class="toc level2"><a href="gjehi.html">30.&nbsp;&nbsp;Contexts and Dependency Injection for the Java EE Platform: Advanced Topics</a></p>
<p class="toc level2"><a href="gkhre.html">31.&nbsp;&nbsp;Running the Advanced Contexts and Dependency Injection Examples</a></p>
<p class="toc level1 tocsp"><a href="bnbpy.html">Part&nbsp;VI&nbsp;Persistence</a></p>
<p class="toc level2"><a href="bnbpz.html">32.&nbsp;&nbsp;Introduction to the Java Persistence API</a></p>
<p class="toc level2"><a href="gijst.html">33.&nbsp;&nbsp;Running the Persistence Examples</a></p>
<p class="toc level2"><a href="bnbtg.html">34.&nbsp;&nbsp;The Java Persistence Query Language</a></p>
<p class="toc level2"><a href="gjitv.html">35.&nbsp;&nbsp;Using the Criteria API to Create Queries</a></p>
<p class="toc level2"><a href="gkjiq.html">36.&nbsp;&nbsp;Creating and Using String-Based Criteria Queries</a></p>
<p class="toc level2"><a href="gkjjf.html">37.&nbsp;&nbsp;Controlling Concurrent Access to Entity Data with Locking</a></p>
<p class="toc level2"><a href="gkjia.html">38.&nbsp;&nbsp;Improving the Performance of Java Persistence API Applications By Setting a Second-Level Cache</a></p>
<p class="toc level1 tocsp"><a href="gijrp.html">Part&nbsp;VII&nbsp;Security</a></p>
<p class="toc level2"><a href="bnbwj.html">39.&nbsp;&nbsp;Introduction to Security in the Java EE Platform</a></p>
<p class="toc level2"><a href="bncas.html">40.&nbsp;&nbsp;Getting Started Securing Web Applications</a></p>
<p class="toc level2"><a href="bnbyk.html">41.&nbsp;&nbsp;Getting Started Securing Enterprise Applications</a></p>
<p class="toc level2"><a href="gjjwx.html">42.&nbsp;&nbsp;Java EE Security: Advanced Topics and Example</a></p>
<p class="toc level1 tocsp"><a href="gijue.html">Part&nbsp;VIII&nbsp;Java EE Supporting Technologies</a></p>
<p class="toc level2"><a href="gijto.html">43.&nbsp;&nbsp;Introduction to Java EE Supporting Technologies</a></p>
<p class="toc level2"><a href="bncih.html">44.&nbsp;&nbsp;Transactions</a></p>
<p class="toc level2"><a href="bncjh.html">45.&nbsp;&nbsp;Resources and Resource Adapters</a></p>
<p class="toc level2"><a href="glodb.html">46.&nbsp;&nbsp;Running the Resource Adapter Example</a></p>
<p class="toc level2"><a href="bncdq.html">47.&nbsp;&nbsp;Java Message Service Concepts</a></p>
<p class="toc level2"><a href="bncgv.html">48.&nbsp;&nbsp;Java Message Service Examples</a></p>
<p class="toc level2"><a href="gkahp.html">49.&nbsp;&nbsp;Bean Validation: Advanced Topics</a></p>
<p class="toc level2"><a href="gkeed.html">50.&nbsp;&nbsp;Using Java EE Interceptors</a></p>
<p class="toc level1 tocsp"><a href="gkgjw.html">Part&nbsp;IX&nbsp;Case Studies</a></p>
<p class="toc level2"><a href="glnvi.html">51.&nbsp;&nbsp;Duke's Bookstore Case Study Example</a></p>
<p class="toc level2"><a href="gkaee.html">52.&nbsp;&nbsp;Duke's Tutoring Case Study Example</a></p>
<p class="toc level2"><a href="glnpw.html">53.&nbsp;&nbsp;Duke's Forest Case Study Example</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td width="10px">&nbsp;</td>
      <td>
         <div class="header">
             <div class="banner">
                <table width="100%" border="0" cellpadding="5" cellspacing="0">
                   <tbody>
                      <tr>
                         <td valign="bottom"><p class="Banner">The Java EE 6 Tutorial
</p></td>
                         <td align="right"  valign="bottom"><img src="graphics/javalogo.png" alt="Java Coffee Cup logo"></td>
                      </tr>
                   </tbody>
                </table>
             </div>

             <div class="header-links">
	         <a href="./index.html">Home</a> | 
<a href="../information/download.html">Download</a> | 
<a href="./javaeetutorial6.pdf">PDF</a> | 
<a href="../information/faq.html">FAQ</a> | 
<a href="http://docs.oracle.com/javaee/support/feedback.htm">Feedback</a>

             </div>
             <div class="navigation">
                 <a href="bnawd.html"><img src="graphics/leftButton.gif" border="0" alt="Previous" title="Previous"></a>
                 <a href="p1.html"><img src="graphics/upButton.gif" border="0" alt="Contents" title="Contents"></a>
                 <a href="bnawn.html"><img src="graphics/rightButton.gif" border="0" alt="Next" title="Next"></a>
             </div>
         </div>

	 <div class="maincontent">      	 
             

<a name="bnawe"></a><h2>Creating the Component Tag Handler</h2>
<a name="indexterm-888"></a><p>After you create your component and renderer classes, you&rsquo;re ready to define how
a tag handler processes the tag representing the component and renderer combination.</p>

<p><a name="indexterm-889"></a><a name="indexterm-890"></a>In JavaServer Faces applications, the tag handler class associated with a component drives the
Render Response phase of the JavaServer Faces lifecycle. For more information on the
JavaServer Faces lifecycle, see <a href="bnaqq.html">The Lifecycle of a JavaServer Faces Application</a>.</p>

<p>The first thing that the tag handler does is to retrieve the
type of the component associated with the tag. Next, it sets the component&rsquo;s attributes
to the values given in the page. It then returns the type
of the renderer (if there is one) to the JavaServer Faces implementation so
that the component&rsquo;s encoding can be performed when the tag is processed. Finally, it
releases resources used during the processing of the tag.</p>

<p>The image map custom component includes two tag handlers: <tt>AreaTag</tt> and <tt>MapTag</tt>.
To see how the operations on a JavaServer Faces tag handler are implemented,
let's take a look at <tt>MapTag</tt>.</p>

<p><a name="indexterm-891"></a>The class extends <tt>javax.faces.webapp.UIComponentELTag</tt>, the base class for all JavaServer Faces tags
that correspond to a component.</p>



<a name="bnawf"></a><h3>Retrieving the Component Type</h3>
<p><a name="indexterm-892"></a>As explained earlier, the first thing the <tt>MapTag</tt> tag handler class does is
to retrieve the type of the component. It does this by using the
<tt>getComponentType</tt> method:</p>

<pre>@Override
public String getComponentType() {
    return ("DemoMap");
}</pre><p>The value returned from <tt>getComponentType</tt> must match the value configured for the component
with the <tt>componentType</tt> attribute of the <tt>@FacesComponent</tt> annotation. (<a href="bnaxi.html">Registering a Custom Component</a> explains how to configure
a component in the application configuration resource file.)</p>



<a name="bnawg"></a><h3>Setting Component Property Values</h3>
<p>After retrieving the type of the component, the tag handler sets the component&rsquo;s
property values to those supplied as tag attributes values in the page. This
section assumes that your component properties are enabled to accept expressions, as explained
in <a href="bnavu.html#bnavy">Enabling Component Properties to Accept Expressions</a>.</p>



<a name="bnawh"></a><h4>Getting the Attribute Values</h4>
<p>Before setting the values in the component class, the tag handler first gets
the attribute values from the page by means of JavaBeans component properties that
correspond to the attributes. The following code shows the property used to access
the value of the <tt>immediate</tt> attribute.</p>

<pre>private ValueExpression immediate = null;

public void setImmediate(ValueExpression immediate) {
    this.immediate = immediate;
}</pre><p>As this code shows, the <tt>setImmediate</tt> method takes a <tt>javax.el.ValueExpression</tt> object. This means that
the <tt>immediate</tt> attribute of the tag accepts value expressions.</p>

<p>Similarly, the <tt>setActionListener</tt> and <tt>setAction</tt> methods take <tt>javax.el.MethodExpression</tt> objects, which means that these
attributes accept method expressions. The following code shows the properties used to access
the values of the <tt>actionListener</tt> and the <tt>action</tt> attributes.</p>

<pre>private MethodExpression actionListener = null;

public void setActionListener(
    MethodExpression actionListener) {
    
    this.actionListener = actionListener;
}
private MethodExpression action = null;

public void setAction(MethodExpression action) {
    this.action = action;
}</pre>

<a name="bnawi"></a><h4>Setting the Component Property Values</h4>
<p>To pass the value of the tag attributes to the component, the
tag handler implements the <tt>setProperties</tt> method. The way <tt>setProperties</tt> passes the attribute values
to the component class depends on whether the values are value expressions or
method expressions.</p>



<a name="bnawj"></a><h5>Setting Value Expressions on Component Properties</h5>
<p>When the attribute value is a value expression, <tt>setProperties</tt> first checks if it
is not a literal expression. If the expression is not a literal,
<tt>setProperties</tt> stores the expression into a collection, from which the component class can
retrieve it and resolve it at the appropriate time. If the expression is
a literal, <tt>setProperties</tt> performs any required type conversion and then does one of
the following:</p>


<ul><li><p>If the attribute is renderer-independent, meaning that it is defined by the component class, <tt>setProperties</tt> calls the corresponding setter method of the component class.</p>

</li>
<li><p>If the attribute is renderer-dependent, <tt>setProperties</tt> stores the converted value into the component&rsquo;s map of generic renderer attributes.</p>

</li></ul>
<p>The following piece of the <tt>MapTag</tt> handler's <tt>setProperties</tt> method sets the renderer-dependent
property, <tt>styleClass</tt>, and the renderer-independent property, <tt>immediate</tt>:</p>

<pre>if (styleClass != null) {
    if (!styleClass.isLiteralText()) {
        map.setValueExpression("styleClass", styleClass);
    } else {
        map.getAttributes().put("styleClass", 
                styleClass.getExpressionString());
    }
}
...
if (immediate != null) {
    if (!immediate.isLiteralText()) {
        map.setValueExpression("immediate", immediate);
    } else {
        map.setImmediate(
                Boolean.valueOf(immediate.getExpressionString()).booleanValue());
    }
}</pre>

<a name="bnawk"></a><h5>Setting Method Expressions on Component Properties</h5>
<p>The process of setting the properties that accept method expressions is done differently
depending on the purpose of the method. The <tt>actionListener</tt> attribute uses a
method expression to reference a method that handles action events. The <tt>action</tt> attribute
uses a method expression either to specify a logical outcome or to reference
a method that returns a logical outcome, which is used for navigation purposes.</p>

<p>To handle the method expression referenced by <tt>actionListener</tt>, the <tt>setProperties</tt> method must wrap
the expression in a special action listener object called <tt>MethodExpressionActionListener</tt>. This listener executes
the method referenced by the expression when it receives the action event. The
<tt>setProperties</tt> method then adds this <tt>MethodExpressionActionListener</tt> object to the list of listeners to be
notified when the event of a user clicking on the map occurs. The
following piece of <tt>setProperties</tt> does all of this:</p>

<pre>if (actionListener != null) {
    map.addActionListener(
        new MethodExpressionActionListener(actionListener));
}</pre><p>If your component fires value change events, your tag handler&rsquo;s <tt>setProperties</tt> method
does a similar thing, except it wraps the expression in a <tt>MethodExpressionValueChangeListener</tt> object and
adds the listener using the <tt>addValueChangeListener</tt> method.</p>

<p>In the case of the method expression referenced by the <tt>action</tt> attribute, the
<tt>setProperties</tt> method uses the <tt>setActionExpression</tt> method of <tt>ActionSource2</tt> to set the corresponding property
on <tt>MapComponent</tt>:</p>

<pre>if (action != null) {
    map.setActionExpression(action);
}</pre>

<a name="bnawl"></a><h3>Providing the Renderer Type</h3>
<p><a name="indexterm-893"></a>After setting the component properties, the tag handler provides a renderer type (if
there is a renderer associated with the component) to the JavaServer Faces implementation.
It does this using the <tt>getRendererType</tt> method:</p>

<pre>@Override
public String getRendererType() {
    return ("DemoMap");
}</pre><p>The renderer type that is returned is the name under which the
renderer is registered with the application. See <a href="bnawa.html">Delegating Rendering to a Renderer</a> for more information.</p>

<p>If your component does not have a renderer associated with it, <tt>getRendererType</tt>
should return <tt>null</tt>. In this case, the <tt>rendererType</tt> element in the <tt>@FacesRenderer</tt> annotation should
also be set to <tt>null</tt>.</p>



<a name="bnawm"></a><h3>Releasing Resources</h3>
<p><a name="indexterm-894"></a><a name="indexterm-895"></a>It&rsquo;s recommended practice that all tag handlers implement a <tt>release</tt> method, which releases resources
allocated during the execution of the tag handler by first calling the <tt>UIComponentTag.release</tt>
method, then setting the resource values to null. The <tt>release</tt> method of <tt>MapTag</tt> is
as follows:</p>

<pre>@Override
public void release() {
    super.release();
    current = null;
    styleClass = null;
    actionListener = null;
    action = null;
    immediate = null;
    styleClass = null;
}</pre>
         </div>
         <div class="navigation">
             <a href="bnawd.html"><img src="graphics/leftButton.gif" border="0" alt="Previous" title="Previous"></a>
             <a href="p1.html"><img src="graphics/upButton.gif" border="0" alt="Contents" title="Contents"></a>
             <a href="bnawn.html"><img src="graphics/rightButton.gif" border="0" alt="Next" title="Next"></a>
         </div>

         <div class="copyright">
      	    <p>Copyright &copy; 2012, Oracle and/or its affiliates. All rights reserved. <a href="docinfo.html">Legal Notices</a></p>
      	 </div>

      </td>
   </tr>
</tbody>
</table>
</body>
</html>

